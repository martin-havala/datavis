import{S as wt,i as Mt,s as Et,k as yt,J as P,q as O,l as _t,m as L,K as I,h as C,r as D,n as _,p as K,b as kt,H as k,C as et,o as At,w as bt}from"../chunks/index.0cb42cb9.js";import"../chunks/transform.f0a34255.js";import{c as zt}from"../chunks/csv.41e40aac.js";import{s as Nt}from"../chunks/select.84cbef7e.js";import{e as Rt}from"../chunks/extent.4cf1c809.js";import{b as Ct,a as vt}from"../chunks/ticks.39a2651d.js";import{m as ht}from"../chunks/max.adfc8a60.js";import{l as Lt}from"../chunks/line.16a03edc.js";const Pt=It(jt);function It(t){return function(r,f,i=f){if(!((f=+f)>=0))throw new RangeError("invalid rx");if(!((i=+i)>=0))throw new RangeError("invalid ry");let{data:e,width:s,height:u}=r;if(!((s=Math.floor(s))>=0))throw new RangeError("invalid width");if(!((u=Math.floor(u!==void 0?u:e.length/s))>=0))throw new RangeError("invalid height");if(!s||!u||!f&&!i)return r;const d=f&&t(f),m=i&&t(i),a=e.slice();return d&&m?(T(d,a,e,s,u),T(d,e,a,s,u),T(d,a,e,s,u),U(m,e,a,s,u),U(m,a,e,s,u),U(m,e,a,s,u)):d?(T(d,e,a,s,u),T(d,a,e,s,u),T(d,e,a,s,u)):m&&(U(m,e,a,s,u),U(m,a,e,s,u),U(m,e,a,s,u)),r}}function T(t,r,f,i,e){for(let s=0,u=i*e;s<u;)t(r,f,s,s+=i,1)}function U(t,r,f,i,e){for(let s=0,u=i*e;s<i;++s)t(r,f,s,s+u,i)}function jt(t){const r=Math.floor(t);if(r===t)return $t(t);const f=t-r,i=2*t+1;return(e,s,u,d,m)=>{if(!((d-=m)>=u))return;let a=r*s[u];const c=m*r,p=c+m;for(let h=u,M=u+c;h<M;h+=m)a+=s[Math.min(d,h)];for(let h=u,M=d;h<=M;h+=m)a+=s[Math.min(d,h+c)],e[h]=(a+f*(s[Math.max(u,h-p)]+s[Math.min(d,h+p)]))/i,a-=s[Math.max(u,h-c)]}}function $t(t){const r=2*t+1;return(f,i,e,s,u)=>{if(!((s-=u)>=e))return;let d=t*i[e];const m=u*t;for(let a=e,c=e+m;a<c;a+=u)d+=i[Math.min(s,a)];for(let a=e,c=s;a<=c;a+=u)d+=i[Math.min(s,a+m)],f[a]=d/r,d-=i[Math.max(e,a-m)]}}function Bt(t,r){let f=0;if(r===void 0)for(let i of t)i!=null&&(i=+i)>=i&&++f;else{let i=-1;for(let e of t)(e=r(e,++i,t))!=null&&(e=+e)>=e&&++f}return f}function Ft(t,r,f){let i;for(;;){const e=Ct(t,r,f);if(e===i||e===0||!isFinite(e))return[t,r];e>0?(t=Math.floor(t/e)*e,r=Math.ceil(r/e)*e):e<0&&(t=Math.ceil(t*e)/e,r=Math.floor(r*e)/e),i=e}}function Ot(t){return Math.max(1,Math.ceil(Math.log(Bt(t))/Math.LN2)+1)}function gt(t,r){let f=0,i=0;if(r===void 0)for(let e of t)e!=null&&(e=+e)>=e&&(++f,i+=e);else{let e=-1;for(let s of t)(s=r(s,++e,t))!=null&&(s=+s)>=s&&(++f,i+=s)}if(f)return i/f}var Dt=Array.prototype,xt=Dt.slice;function Ht(t,r){return t-r}function Jt(t){for(var r=0,f=t.length,i=t[f-1][1]*t[0][0]-t[f-1][0]*t[0][1];++r<f;)i+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return i}const H=t=>()=>t;function Kt(t,r){for(var f=-1,i=r.length,e;++f<i;)if(e=Tt(t,r[f]))return e;return 0}function Tt(t,r){for(var f=r[0],i=r[1],e=-1,s=0,u=t.length,d=u-1;s<u;d=s++){var m=t[s],a=m[0],c=m[1],p=t[d],h=p[0],M=p[1];if(Ut(m,p,r))return 0;c>i!=M>i&&f<(h-a)*(i-c)/(M-c)+a&&(e=-e)}return e}function Ut(t,r,f){var i;return Vt(t,r,f)&&Wt(t[i=+(t[0]===r[0])],f[i],r[i])}function Vt(t,r,f){return(r[0]-t[0])*(f[1]-t[1])===(f[0]-t[0])*(r[1]-t[1])}function Wt(t,r,f){return t<=r&&r<=f||f<=r&&r<=t}function Xt(){}var F=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function dt(){var t=1,r=1,f=Ot,i=m;function e(a){var c=f(a);if(Array.isArray(c))c=c.slice().sort(Ht);else{const p=Rt(a,Yt);for(c=vt(...Ft(p[0],p[1],c),c);c[c.length-1]>=p[1];)c.pop();for(;c[1]<p[0];)c.shift()}return c.map(p=>s(a,p))}function s(a,c){const p=c==null?NaN:+c;if(isNaN(p))throw new Error(`invalid value: ${c}`);var h=[],M=[];return u(a,p,function(l){i(l,a,p),Jt(l)>0?h.push([l]):M.push(l)}),M.forEach(function(l){for(var g=0,E=h.length,v;g<E;++g)if(Kt((v=h[g])[0],l)!==-1){v.push(l);return}}),{type:"MultiPolygon",value:c,coordinates:h}}function u(a,c,p){var h=new Array,M=new Array,l,g,E,v,o,A;for(l=g=-1,v=J(a[0],c),F[v<<1].forEach(x);++l<t-1;)E=v,v=J(a[l+1],c),F[E|v<<1].forEach(x);for(F[v<<0].forEach(x);++g<r-1;){for(l=-1,v=J(a[g*t+t],c),o=J(a[g*t],c),F[v<<1|o<<2].forEach(x);++l<t-1;)E=v,v=J(a[g*t+t+l+1],c),A=o,o=J(a[g*t+l+1],c),F[E|v<<1|o<<2|A<<3].forEach(x);F[v|o<<3].forEach(x)}for(l=-1,o=a[g*t]>=c,F[o<<2].forEach(x);++l<t-1;)A=o,o=J(a[g*t+l+1],c),F[o<<2|A<<3].forEach(x);F[o<<3].forEach(x);function x(z){var b=[z[0][0]+l,z[0][1]+g],N=[z[1][0]+l,z[1][1]+g],n=d(b),y=d(N),w,R;(w=M[n])?(R=h[y])?(delete M[w.end],delete h[R.start],w===R?(w.ring.push(N),p(w.ring)):h[w.start]=M[R.end]={start:w.start,end:R.end,ring:w.ring.concat(R.ring)}):(delete M[w.end],w.ring.push(N),M[w.end=y]=w):(w=h[y])?(R=M[n])?(delete h[w.start],delete M[R.end],w===R?(w.ring.push(N),p(w.ring)):h[R.start]=M[w.end]={start:R.start,end:w.end,ring:R.ring.concat(w.ring)}):(delete h[w.start],w.ring.unshift(b),h[w.start=n]=w):h[n]=M[y]={start:n,end:y,ring:[b,N]}}}function d(a){return a[0]*2+a[1]*(t+1)*4}function m(a,c,p){a.forEach(function(h){var M=h[0],l=h[1],g=M|0,E=l|0,v=nt(c[E*t+g]);M>0&&M<t&&g===M&&(h[0]=mt(M,nt(c[E*t+g-1]),v,p)),l>0&&l<r&&E===l&&(h[1]=mt(l,nt(c[(E-1)*t+g]),v,p))})}return e.contour=s,e.size=function(a){if(!arguments.length)return[t,r];var c=Math.floor(a[0]),p=Math.floor(a[1]);if(!(c>=0&&p>=0))throw new Error("invalid size");return t=c,r=p,e},e.thresholds=function(a){return arguments.length?(f=typeof a=="function"?a:Array.isArray(a)?H(xt.call(a)):H(a),e):f},e.smooth=function(a){return arguments.length?(i=a?m:Xt,e):i===m},e}function Yt(t){return isFinite(t)?t:NaN}function J(t,r){return t==null?!1:+t>=r}function nt(t){return t==null||isNaN(t=+t)?-1/0:t}function mt(t,r,f,i){const e=i-r,s=f-r,u=isFinite(e)||isFinite(s)?e/s:Math.sign(e)/Math.sign(s);return isNaN(u)?t:t+u-.5}function qt(t){return t[0]}function Gt(t){return t[1]}function Qt(){return 1}function Zt(){var t=qt,r=Gt,f=Qt,i=960,e=500,s=20,u=2,d=s*3,m=i+d*2>>u,a=e+d*2>>u,c=H(20);function p(o){var A=new Float32Array(m*a),x=Math.pow(2,-u),z=-1;for(const $ of o){var b=(t($,++z,o)+d)*x,N=(r($,z,o)+d)*x,n=+f($,z,o);if(n&&b>=0&&b<m&&N>=0&&N<a){var y=Math.floor(b),w=Math.floor(N),R=b-y-.5,j=N-w-.5;A[y+w*m]+=(1-R)*(1-j)*n,A[y+1+w*m]+=R*(1-j)*n,A[y+1+(w+1)*m]+=R*j*n,A[y+(w+1)*m]+=(1-R)*j*n}}return Pt({data:A,width:m,height:a},s*x),A}function h(o){var A=p(o),x=c(A),z=Math.pow(2,2*u);return Array.isArray(x)||(x=vt(Number.MIN_VALUE,ht(A)/z,x)),dt().size([m,a]).thresholds(x.map(b=>b*z))(A).map((b,N)=>(b.value=+x[N],M(b)))}h.contours=function(o){var A=p(o),x=dt().size([m,a]),z=Math.pow(2,2*u),b=N=>{N=+N;var n=M(x.contour(A,N*z));return n.value=N,n};return Object.defineProperty(b,"max",{get:()=>ht(A)/z}),b};function M(o){return o.coordinates.forEach(l),o}function l(o){o.forEach(g)}function g(o){o.forEach(E)}function E(o){o[0]=o[0]*Math.pow(2,u)-d,o[1]=o[1]*Math.pow(2,u)-d}function v(){return d=s*3,m=i+d*2>>u,a=e+d*2>>u,h}return h.x=function(o){return arguments.length?(t=typeof o=="function"?o:H(+o),h):t},h.y=function(o){return arguments.length?(r=typeof o=="function"?o:H(+o),h):r},h.weight=function(o){return arguments.length?(f=typeof o=="function"?o:H(+o),h):f},h.size=function(o){if(!arguments.length)return[i,e];var A=+o[0],x=+o[1];if(!(A>=0&&x>=0))throw new Error("invalid size");return i=A,e=x,v()},h.cellSize=function(o){if(!arguments.length)return 1<<u;if(!((o=+o)>=1))throw new Error("invalid cell size");return u=Math.floor(Math.log(o)/Math.LN2),v()},h.thresholds=function(o){return arguments.length?(c=typeof o=="function"?o:Array.isArray(o)?H(xt.call(o)):H(o),h):c},h.bandwidth=function(o){if(!arguments.length)return Math.sqrt(s*(s+1));if(!((o=+o)>=0))throw new Error("invalid bandwidth");return s=(Math.sqrt(4*o*o+1)-1)/2,v()},h}function St(t){let r,f,i,e,s,u,d,m,a,c,p,h,M,l,g,E,v,o,A,x,z,b,N,n,y,w,R,j,$,V,Y;return{c(){r=yt("section"),f=P("svg"),i=P("g"),e=P("g"),s=P("text"),u=O("Oldest living people"),d=P("text"),m=O(`Here is the list of people still fighting for the longest lifespan
            `),a=P("text"),c=P("a"),p=O("datasource: wiki"),h=P("g"),M=P("path"),l=P("text"),g=O("male"),E=P("g"),v=P("path"),o=P("text"),A=O("female "),x=P("g"),z=P("path"),b=P("text"),N=O("alive"),n=P("g"),y=P("path"),w=P("text"),R=O("passed away"),j=P("g"),$=P("path"),V=P("text"),Y=O("world average"),this.h()},l(W){r=_t(W,"SECTION",{});var X=L(r);f=I(X,"svg",{viewBox:!0,"xmlns:xlink":!0,class:!0});var q=L(f);i=I(q,"g",{}),L(i).forEach(C),e=I(q,"g",{class:!0,transform:!0});var B=L(e);s=I(B,"text",{x:!0,y:!0,style:!0});var rt=L(s);u=D(rt,"Oldest living people"),rt.forEach(C),d=I(B,"text",{x:!0,y:!0,style:!0});var at=L(d);m=D(at,`Here is the list of people still fighting for the longest lifespan
            `),at.forEach(C),a=I(B,"text",{x:!0,y:!0,style:!0});var ot=L(a);c=I(ot,"a",{href:!0});var st=L(c);p=D(st,"datasource: wiki"),st.forEach(C),ot.forEach(C),h=I(B,"g",{class:!0,transform:!0});var G=L(h);M=I(G,"path",{d:!0,class:!0}),L(M).forEach(C),l=I(G,"text",{});var lt=L(l);g=D(lt,"male"),lt.forEach(C),G.forEach(C),E=I(B,"g",{class:!0,transform:!0});var Q=L(E);v=I(Q,"path",{d:!0,class:!0}),L(v).forEach(C),o=I(Q,"text",{});var it=L(o);A=D(it,"female "),it.forEach(C),Q.forEach(C),x=I(B,"g",{class:!0,transform:!0});var Z=L(x);z=I(Z,"path",{d:!0,class:!0}),L(z).forEach(C),b=I(Z,"text",{});var ft=L(b);N=D(ft,"alive"),ft.forEach(C),Z.forEach(C),n=I(B,"g",{class:!0,transform:!0});var S=L(n);y=I(S,"path",{d:!0,class:!0}),L(y).forEach(C),w=I(S,"text",{});var ct=L(w);R=D(ct,"passed away"),ct.forEach(C),S.forEach(C),j=I(B,"g",{class:!0,transform:!0});var tt=L(j);$=I(tt,"path",{d:!0,class:!0}),L($).forEach(C),V=I(tt,"text",{});var ut=L(V);Y=D(ut,"world average"),ut.forEach(C),tt.forEach(C),B.forEach(C),q.forEach(C),X.forEach(C),this.h()},h(){_(s,"x","70"),_(s,"y","0"),K(s,"font-size","3em"),K(s,"text-anchor","end"),_(d,"x","70"),_(d,"y","50"),K(d,"font-size",".9em"),K(d,"text-anchor","end"),_(c,"href","https://en.wikipedia.org/wiki/List_of_verified_oldest_people"),_(a,"x","70"),_(a,"y","80"),K(a,"font-size",".8em"),K(a,"text-anchor","end"),_(M,"d","M0,0 h20"),_(M,"class","person_contour alive"),_(h,"class","male alive"),_(h,"transform","translate(0, 120)"),_(v,"d","M0,0 h20"),_(v,"class","person_contour alive"),_(E,"class","female alive"),_(E,"transform","translate(0, 140)"),_(z,"d","M0,0 h20"),_(z,"class","person_contour alive"),_(x,"class","alive"),_(x,"transform","translate(0, 180)"),_(y,"d","M0,0 h20"),_(y,"class","person_contour deceased"),_(n,"class",""),_(n,"transform","translate(0, 200)"),_($,"d","M0,0 h20"),_($,"class","average"),_(j,"class","avg_contour"),_(j,"transform","translate(0, 240)"),_(e,"class","side_legend"),_(e,"transform","translate(700, 50)"),_(f,"viewBox","0 0 800 800"),_(f,"xmlns:xlink","http://www.w3.org/1999/xlink"),_(f,"class","svelte-11xa386")},m(W,X){kt(W,r,X),k(r,f),k(f,i),t[2](i),k(f,e),k(e,s),k(s,u),k(e,d),k(d,m),k(e,a),k(a,c),k(c,p),k(e,h),k(h,M),k(h,l),k(l,g),k(e,E),k(E,v),k(E,o),k(o,A),k(e,x),k(x,z),k(x,b),k(b,N),k(e,n),k(n,y),k(n,w),k(w,R),k(e,j),k(j,$),k(j,V),k(V,Y)},p:et,i:et,o:et,d(W){W&&C(r),t[2](null)}}}function pt(t,r){r&&(t.append("text").text(r),t.append("circle").attr("r",2))}function te(t,r,f){let{data:i}=r;const e=zt(i.centenarians).map(l=>({...l,age:Math.floor(l.age)})),s=e.reduce((l,g)=>l.find(E=>E.age==g.age&&E.gender==g.gender&&E.still_alive==g.still_alive)?l:[...l,g],[]),u=(l,g)=>{const E=2*Math.PI*Math.random(),v=300-10*g,o=700-l*Math.sin(E);return{x:v,y:o}},d=(l,g)=>{const E=g*(Math.PI/180),v=l[0]+5e3*Math.cos(E),o=l[1]-5e3*Math.sin(E);return[l,[v,o]]},m=[{gender:"male",age:70,label:"average"},{gender:"female",age:75,label:"average"}],a=Array(44).fill(1).map((l,g)=>u(12*g-1,g));let c,p;const h=([[l,g],[E,v]],[[o,A],[x,z]])=>{let b,N,n;return b=(E-l)*(z-A)-(x-o)*(v-g),b===0?null:(n=((z-A)*(x-l)+(o-x)*(z-g))/b,N=((g-v)*(x-l)+(E-l)*(z-g))/b,0<n&&n<1&&0<N&&N<1?[l+(E-l)*n,g+(v-g)*n]:null)};At(()=>{p=Nt(c);{const n={male:1,female:1,abs:1};e.forEach(y=>{y.still_alive==="alive"&&(y.aliveRank=n[y.gender]++,y.aliveRankAbs=n.abs++)})}const l=Zt().size([800,800]).cellSize(30).bandwidth(240).thresholds(150).x(({x:n})=>n).y(({y:n})=>n)(a).reverse().map(n=>n.coordinates).flat(2).slice(0,125),g=Lt().x(n=>n[0]).y(n=>n[1]);p.append("g").attr("class","contours").selectAll("g").data(l.filter((n,y)=>y%5==0)).join("path").attr("class","contour").attr("d",g);const E=[gt(l[0].map(n=>n[0])),gt(l[0].map(n=>n[1]))],v=(n,y=0)=>{const w=d(E,y);for(let R=0;R<n.length-1;R++){const j=[n[R],n[R+1]],$=h(w,j);if($)return $}return null},o=s.map(n=>({centenarian:n,path:l[Math.floor(n.age)]}));p.append("g").attr("class","person_contours").selectAll("g").data(o).join("g").attr("class",n=>`person_contour ${n.centenarian.still_alive} ${n.centenarian.gender} ${n.centenarian.aliveRank==1?"oldest":""}`).append("path").attr("d",n=>g(n.path));const x=m.map(n=>({grp:n,path:l[Math.floor(n.age)]}));p.selectAll("g.avg_contours").data(x).join("g").attr("class",n=>`avg_contour ${n.grp.gender}`).append("path").attr("d",n=>g(n.path)),pt(p.append("g").attr("class","people_contours_labels").selectAll("g").data(e.filter(n=>!!n.aliveRank)).join("g").attr("transform",n=>{var y;return`translate(${(y=v(l[n.age],70-5*(n.aliveRankAbs??0)))==null?void 0:y.join()})`}),n=>n.aliveRank?`${n.name}`:"");const b=l.filter((n,y)=>y%10==0).map((n,y)=>v(n,80)),N=p.append("g").attr("class","legend").selectAll("g").data(b).join("g").attr("transform",n=>`translate(${n==null?void 0:n.join()})`).style("display",(n,y)=>y?"visible":"none");pt(N,(n,y)=>y*10)});function M(l){bt[l?"unshift":"push"](()=>{c=l,f(0,c)})}return t.$$set=l=>{"data"in l&&f(1,i=l.data)},[c,i,M]}class fe extends wt{constructor(r){super(),Mt(this,r,te,St,Et,{data:1})}}export{fe as default};
