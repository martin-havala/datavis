WITH m as (
SELECT
    geo, unit, 
     SUBSTRING([TIME_PERIOD],0,5) as year,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '01') m01,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '02') m02,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '03') m03,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '04') m04,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '05') m05,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '06') m06,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '07') m07,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '08') m08,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '09') m09,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '10') m10,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '11') m11,
     SUM(OBS_VALUE) FILTER (WHERE SUBSTRING([TIME_PERIOD],6,2) =  '12') m12,
     SUM(OBS_VALUE) as total,
     SUM(OBS_VALUE) / 12 as average

from
    my_tourism
 GROUP BY geo, unit, SUBSTRING([TIME_PERIOD],0,5)
)
SELECT m.*, p.OBS_VALUE as population from m 
JOIN population p 
    ON m.geo = p.geo
   AND p.TIME_PERIOD = m.year
   ORDER BY total DESC
